name: infra-truth-report
on:
  workflow_dispatch:
  schedule:
    - cron: "0 6 * * *"  # daily 6am CT
jobs:
  report:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-node@v4
        with:
          node-version: "20"
      - run: npm ci || npm i
      - run: npx ts-node scripts/generate_infra_report.ts > 
          infra_truth_report.json
      - uses: actions/upload-artifact@v4
        with:
          name: infra-truth-report
          path: infra_truth_report.json
    if: ${{ (github.event_name != 'push' || !(contains(github.event.head_commit.message, '[skip ci]') || contains(github.event.head_commit.message, '[ci skip]'))) && (github.event_name != 'pull_request' || !(contains(github.event.pull_request.title, '[skip ci]') || contains(github.event.pull_request.title, '[ci skip]'))) }}
